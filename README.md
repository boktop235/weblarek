https://github.com/boktop235/weblarek

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
# Интернет-магазин «Web-Larёk»
«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и  отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component
Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`


#### Класс Api
Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter
Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` -  хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Данные
Данные разделены на две основные сущности: 
1) о товаре
2) о заказе покупателя

1. Интерфейс **IProduct:** 
- название
- описание
- изображение
- категория товара
- цена

Реализация в API через GET-запросы: 
**Product List:**
- total: number
- items: IProduct[]

**Product Item:**
- id: string
- description: string
- image: string
- title: string
- category: string
- price: number | null 

2. Интерфейс **IBuyer:** 
- способ оплаты
- адрес доставки
- емейл
- телефон

Реализация в API через POST-запрос: 
**Response (success):**
- id: string
- total: number

**Body:**
- payment: TPayment ('card' | 'cash')
- email: string
- phone: string
- address: string
- total: number
- items: string[]

#### Модели данных

1. **Каталог товаров** 
- хранение товаров, которые можно купить в приложении;

#### Класс ProductList: 
Поля класса:
`productsList: IProduct[]` - набор товаров
`selectedProduct: IProduct | null;` - выбранный товар

Методы класса: 
`setItems(products): void` - сохранение массива товаров полученного в параметрах метода;
`getItems(): IProduct[]` - получение массива товаров из модели;
`getItem(id): IProduct | undefined` - получение одного товара по его id;
`setSelectedItem(id): void` - сохранение товара для подробного отображения по его id;
`getSelectedItem(): IProduct | null` - получение товара для подробного отображения.

2. **Корзина с товарами**
- хранение товаров, которые пользователь выбрал для покупки;

#### Класс Cart:
Поля класса: 
`products: IProduct[]` - набор товаров в карточке

Методы класса: 
`getItems(): IProduct[]` - получение массива товаров в корзине;
`addItem(product): void` - добавление товара, который был получен в параметре, в массив корзины;
`removeItem(product): void` - удаление товара, полученного в параметре из массива корзины;
`clear(): void` - очистка корзины;
`getTotalPrice(): number` - получение стоимости всех товаров в корзине;
`getItemsCount(): number` - получение количества товаров в корзине;
`contains(id): boolean` - проверка наличия товара в корзине по его id, полученного в параметр метода.

3. **Покупатель**
- данные покупателя, которые должны быть указаны при оформлении заказа;

#### Класс Buyer:
Поля класса:

`payment: TPayment` - способ оплаты 
`email: string` - email покупателя 
`phone: string` - телефон покупателя 
`address: string` - адрес доставки 

Методы класса: 
`setData(data: Partial<IBuyer>): void` - сохраняет данные покупателя. Принимает объект с частичными данными, позволяя обновлять только отдельные поля без удаления остальных
`getData(): IBuyer` - возвращает все данные покупателя в виде объекта IBuyer
`clear(): void`- очищает все данные покупателя, восстанавливая значения по умолчанию
`validate(): IBuyerValidationResult` - выполняет валидацию данных и возвращает объект с информацией об ошибках для каждого поля

#### Слой коммуникации
Класс ApiCommunication - коммуникатор для работы с интерфейсом IApi и Api.
Поля класса наследуются из класса Api:
`baseUrl: string`
`options: RequestInit`

Методы: 
`getCatalog()` - запрос на эндпоинт /product/ - возвращает массив товаров (использует метод get класса Api)
`createOrder()` - на эндпоинт /order/ - в теле данные о покупателе и выбранных товарах (использует метод post класса Api)

# Слой представления (View)

## Переиспользуемые сущности (базовые абстрактные классы)

### Card - карточка товара

Используется как общий класс для карточек:
- в каталоге (класс `CardCatalog`)
- в модальном окне (класс `CardPreview`)
- в корзине (класс `CardBasket`)

**Конструктор:** `container: HTMLElement`

**Поля:**
- `_title: HTMLElement` - название товара
- `_price: HTMLElement` - цена товара

**Методы:**
- `set title(value: string)` - устанавливает название товара
- `set price(value: number)` - устанавливает цену товара
- `protected setImage(element: HTMLImageElement, src: string, alt?: string)` - устанавливает изображение

### Form - форма

Используется как общий класс для форм:
- выбор оплаты и ввод адреса (`FormOrder`)
- контактные данные (`FormContacts`)

**Конструктор:** `container: HTMLElement, actions: any`

**Поля:**
- `_errors: HTMLElement` - отображение ошибок формы
- `_submitButton: HTMLButtonElement` - кнопка отправки формы

**Методы:**
- `set errors(value: string)` - устанавливает текст ошибки
- `set submitButtonDisabled(value: boolean)` - включает/отключает кнопку отправки формы
- `checkErrors()` - проверяет наличие ошибок формы

## Перечень View-классов

### Header - корзина с счетчиком товаров

**Конструктор:** `container: HTMLElement, events: any`

**Поля:**
- `_counter: HTMLElement` - количество товаров в корзине
- `_basket: HTMLButtonElement` - кнопка открытия корзины
- `events: any` - ссылка на объект событий для уведомления о действиях пользователя

**Метод:**
- `set counter(value: number)` - устанавливает количество товаров в корзине

### Gallery - каталог товаров

**Конструктор:** `container: HTMLElement`

**Поле:**
- `catalogElement: HTMLElement` - контейнер для отображения карточек товаров

**Метод:**
- `set catalog(items: HTMLElement[])` - заменяет содержимое карточками товаров

### Basket - корзина

**Конструктор:** `container: HTMLElement, events: any`

**Поля:**
- `_list: HTMLElement` - контейнер для списка карточек товаров
- `_button: HTMLButtonElement` - кнопка оформления заказа
- `_price: HTMLElement` - общая стоимость корзины

**Методы:**
- `set buttonDisabled(value: boolean)` - включает/отключает кнопку оформления заказа
- `set basket(items: HTMLElement[])` - обновляет список товаров в корзине
- `set total(value: number)` - обновляет общую стоимость товаров в корзине

### CardCatalog - карточка товара в каталоге

**Конструктор:** `container: HTMLElement, events: any`

**Поля:**
- `cardImage: HTMLImageElement` - изображение товара
- `cardCategory: HTMLElement` - категория товара
- `id: string` - идентификатор товара
- `events: any` - ссылка на объект событий для уведомления о действиях пользователя

**Методы:**
- `set category(value: string)` - устанавливает текст категории и CSS-классы согласно categoryMap
- `set image(value: string)` - устанавливает изображение товара
- `render(data: TCardCatalog): HTMLElement` - рендерит карточку по данным

### CardPreview - детали карточки товара

**Конструктор:** `container: HTMLElement, events: any`

**Поля:**
- `_image: HTMLImageElement` - изображение товара
- `_category: HTMLElement` - категория товара
- `_description: HTMLElement` - описание товара
- `_button: HTMLButtonElement` - кнопка добавления/удаления товара
- `_inCart: boolean` - находится ли товар в корзине
- `_id: string` - идентификатор товара
- `events: any` - ссылка на объект событий для уведомления о действиях пользователя

**Методы:**
- `set category(value: string)` - устанавливает текст категории и CSS-классы
- `set image(value: string)` - устанавливает изображение товара
- `set description(value: string)` - устанавливает текст описания товара
- `set inCart(value: boolean)` - устанавливает состояние корзины
- `render(data: any): HTMLElement` - рендерит карточку по данным

### CardBasket - карточка товара в корзине

**Конструктор:** `container: HTMLElement, events: any`

**Поля:**
- `_index: HTMLElement` - порядковый номер товара в корзине
- `_deleteButton: HTMLButtonElement` - кнопка удаления товара из корзины
- `_id: string` - идентификатор товара
- `events: any` - ссылка на объект событий для уведомления о действиях пользователя

**Методы:**
- `set index(value: number)` - устанавливает порядковый номер
- `render(data: any): HTMLElement` - рендерит карточку по данным

### FormOrder - форма с выбором оплаты и адреса

**Конструктор:** `container: HTMLElement, actions: any, events: any`

**Поля:**
- `_paymentCard: HTMLButtonElement` - кнопка выбора оплаты картой
- `_paymentCash: HTMLButtonElement` - кнопка выбора оплаты наличными
- `_addressInput: HTMLInputElement` - поле ввода адреса
- `_submitButton: HTMLButtonElement` - кнопка отправки формы

**Методы:**
- `selectPayment(payment: string)` - выбор способа оплаты
- `set payment(value: string)` - устанавливает способ оплаты
- `set address(value: string)` - устанавливает адрес
- `set submitButtonDisabled(value: boolean)` - включает/отключает кнопку отправки
- `isAddressValid(): boolean` - проверяет корректность адреса
- `checkErrors(): boolean` - проверяет наличие ошибок формы

### FormContacts - форма с контактными данными

**Конструктор:** `container: HTMLElement, actions: any, events: any`

**Поля:**
- `_email: HTMLInputElement` - поле ввода почты
- `_phone: HTMLInputElement` - поле ввода телефона
- `_submitButton: HTMLButtonElement` - кнопка отправки формы

**Методы:**
- `set email(value: string)` - устанавливает значение поля email
- `set phone(value: string)` - устанавливает значение поля телефона
- `set submitButtonDisabled(value: boolean)` - включает/отключает кнопку отправки
- `isContactsValid(): boolean` - проверяет корректность почты и телефона
- `checkErrors(): boolean` - проверяет наличие ошибок формы

### Success - подтверждение успешного заказа

**Конструктор:** `container: HTMLElement, actions: any`

**Поля:**
- `_description: HTMLElement` - отображение списанной суммы
- `_button: HTMLButtonElement` - кнопка закрытия окна

**Методы:**
- `set total(value: number)` - устанавливает сумму списания

### Modal - модальное окно

**Конструктор:** `container: HTMLElement, events: any`

**Поля:**
- `closeButton: HTMLButtonElement` - кнопка закрытия модального окна
- `modalElement: HTMLElement` - контейнер для контента модального окна
- `page: HTMLElement` - элемент страницы для блокировки скролла
- `isOpen: boolean` - состояние модального окна

**Методы:**
- `set content(elem: HTMLElement)` - устанавливает контент модального окна
- `open()` - открывает модальное окно
- `close()` - закрывает модальное окно

# Презентер (main.ts)

Связывает Модели, Представления и API, организует бизнес-логику приложения и управление событиями.

### Модели
- `ProductList` - управление каталогом товаров
- `Cart` - управление корзиной товаров  
- `Buyer` - управление данными покупателя

### API
- `ApiCommunication` - взаимодействие с сервером для получения каталога и создания заказов

### View компоненты
- `Header` - заголовок с счетчиком корзины
- `Gallery` - галерея товаров
- `Modal` - модальное окно
- `CardCatalog` - карточка товара в каталоге
- `CardPreview` - детальный просмотр товара
- `Basket` - корзина товаров
- `CardBasket` - карточка товара в корзине
- `FormOrder` - форма заказа
- `FormContacts` - форма контактов
- `Success` - подтверждение заказа

## Обработка событий

Презентер подписан на события через `events.on(...)`:

### `catalog:changed`
- **Описание:** Рендер карточек каталога в галерее после обновления модели Catalog
- **Действия:** Создает карточки товаров и обновляет галерею

### `card:select`
- **Описание:** Открывает модальное окно с превью карточки товара
- **Действия:** Находит товар по ID, создает CardPreview и открывает в модальном окне

### `card:add-product`
- **Описание:** Добавляет товар в корзину
- **Действия:** Находит товар по ID, добавляет в корзину, обновляет счетчик в Header, закрывает модальное окно

### `card:remove-product`
- **Описание:** Удаляет товар из корзины
- **Действия:** Находит товар по ID, удаляет из корзины, обновляет счетчик в Header, переоткрывает корзину

### `cart:open`
- **Описание:** Открывает модальное окно с корзиной
- **Действия:** Создает карточки товаров корзины (CardBasket), рендерит их, отображает общую сумму заказа

### `cart:order`
- **Описание:** Открывает форму заказа (FormOrder) в модальном окне
- **Действия:** Восстанавливает сохраненные данные покупателя (способ оплаты и адрес)

### `cart:contacts`
- **Описание:** Открывает форму контактов (FormContacts) в модальном окне
- **Действия:** Восстанавливает сохраненные данные (email и телефон), создает объект IOrder и вызывает `apiCommunication.createOrder(...)`

### `cart:success`
- **Описание:** Открывает модальное окно успешно созданного заказа (Success)
- **Действия:** Показывает сумму списанных средств, при закрытии очищает корзину и данные покупателя

### `form:payment-change`
- **Описание:** Сохраняет способ оплаты в модели Buyer
- **Действия:** Обновляет данные покупателя

### `form:address-change`
- **Описание:** Сохраняет адрес в модели Buyer
- **Действия:** Обновляет данные покупателя

### `form:email-change`
- **Описание:** Сохраняет email в модели Buyer
- **Действия:** Обновляет данные покупателя

### `form:phone-change`
- **Описание:** Сохраняет телефон в модели Buyer
- **Действия:** Обновляет данные покупателя

## Поток данных

1. **Инициализация приложения:**
   - Загрузка каталога товаров с сервера
   - Обновление счетчика корзины

2. **Работа с товарами:**
   - Просмотр каталога → `catalog:changed`
   - Выбор товара → `card:select`
   - Добавление/удаление из корзины → `card:add-product` / `card:remove-product`

3. **Оформление заказа:**
   - Открытие корзины → `cart:open`
   - Оформление заказа → `cart:order` → `cart:contacts`
   - Подтверждение → `cart:success`

4. **Сохранение данных:**
   - Все изменения форм автоматически сохраняются в модели Buyer через соответствующие события

